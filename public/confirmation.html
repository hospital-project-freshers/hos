<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Confirm Appointment - Book Appointment</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">
  <!-- Header -->
  <div class="p-4 flex justify-between items-center bg-white shadow">
    <h1 class="text-2xl font-bold text-blue-600">MediCare</h1>
    <button onclick="history.back()" class="text-gray-600 hover:text-gray-800">← Back</button>
  </div>

  <!-- Stepper -->
  <div class="max-w-4xl mx-auto mt-8">
    <div class="flex items-center justify-between relative">
      <div class="relative flex justify-between w-full items-center">
        <!-- Step 1 -->
        <div class="step-item text-center z-10">
          <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto">✓</div>
          <p class="mt-2 text-sm">Patient details</p>
        </div>

        <!-- Line 1-2 -->
        <div class="flex-1 h-1 bg-blue-500 mx-4"></div>

        <!-- Step 2 -->
        <div class="step-item text-center z-10">
          <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto">✓</div>
          <p class="mt-2 text-sm">Select doctor</p>
        </div>

        <!-- Line 2-3 -->
        <div class="flex-1 h-1 bg-blue-500 mx-4"></div>

        <!-- Step 3 -->
        <div class="step-item text-center z-10">
          <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto">✓</div>
          <p class="mt-2 text-sm">Choose Date & Time</p>
        </div>

        <!-- Line 3-4 -->
        <div class="flex-1 h-1 bg-blue-500 mx-4"></div>

        <!-- Step 4 -->
        <div class="step-item text-center z-10">
          <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto">✓</div>
          <p class="mt-2 text-sm font-medium">Confirmation</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Section -->
  <style>
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .pulse-animation {
      animation: pulse 2s infinite;
    }
  </style>

  <div class="max-w-5xl mx-auto mt-8 px-4">
    <!-- Header Card -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-2xl mb-8 p-6 text-center">
      <h2 class="text-3xl font-bold text-white mb-2">Appointment Confirmation</h2>
      <p class="text-blue-100">Please review your appointment details below</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Patient Information Card -->
      <div class="bg-white rounded-xl shadow-lg card-hover p-6">
        <div class="flex items-center mb-6">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Patient Details</h3>
        </div>
        <div class="space-y-4">
          <div class="flex items-center border-b border-gray-100 pb-3">
            <span class="text-gray-600 font-medium w-24">Name</span>
            <span id="confirmPatientName" class="text-gray-800 font-semibold"></span>
          </div>
          <div class="flex items-center border-b border-gray-100 pb-3">
            <span class="text-gray-600 font-medium w-24">Age/Gender</span>
            <span id="confirmPatientAgeGender" class="text-gray-800 font-semibold"></span>
          </div>
          <div class="flex items-center border-b border-gray-100 pb-3">
            <span class="text-gray-600 font-medium w-24">Blood Group</span>
            <span id="confirmPatientBlood" class="text-gray-800 font-semibold"></span>
          </div>
          <div class="flex items-center">
            <span class="text-gray-600 font-medium w-24">Contact</span>
            <span id="confirmPatientContact" class="text-gray-800 font-semibold"></span>
          </div>
        </div>
      </div>

      <!-- Doctor Information Card -->
      <div class="bg-white rounded-xl shadow-lg card-hover p-6">
        <div class="flex items-center mb-6">
          <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mr-4">
            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Doctor Details</h3>
        </div>
        <div class="space-y-4">
          <div class="flex items-center border-b border-gray-100 pb-3">
            <span class="text-gray-600 font-medium w-24">Name</span>
            <span id="confirmDoctor" class="text-gray-800 font-semibold"></span>
          </div>
          <div class="flex items-center">
            <span class="text-gray-600 font-medium w-24">Specialty</span>
            <span id="confirmSpecialty" class="text-gray-800 font-semibold"></span>
          </div>
        </div>
      </div>

      <!-- Appointment Schedule Card -->
      <div class="bg-white rounded-xl shadow-lg card-hover p-6 md:col-span-2">
        <div class="flex items-center mb-6">
          <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Appointment Schedule</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="flex items-center bg-gray-50 p-4 rounded-lg">
            <svg class="w-6 h-6 text-gray-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <div>
              <p class="text-sm text-gray-600">Date</p>
              <p id="confirmDate" class="font-semibold text-gray-800"></p>
            </div>
          </div>
          <div class="flex items-center bg-gray-50 p-4 rounded-lg">
            <svg class="w-6 h-6 text-gray-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <p class="text-sm text-gray-600">Time</p>
              <p id="confirmTime" class="font-semibold text-gray-800"></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-center space-x-6 mt-12">
      <button onclick="history.back()" class="group px-6 py-3 bg-white border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-all duration-200 flex items-center">
        <svg class="w-5 h-5 mr-2 transform group-hover:-translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back
      </button>
      <button onclick="confirmBooking()" id="confirmBookingBtn" class="group px-8 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:shadow-lg transition-all duration-200 flex items-center pulse-animation">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Confirm Booking
      </button>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300">
      <div class="p-8">
        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6">
          <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-center text-gray-900 mb-6">Appointment Booked Successfully!</h3>
        <button onclick="goToHome()" class="w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:shadow-lg transition-all duration-200 flex items-center justify-center group">
          <svg class="w-5 h-5 mr-2 transform group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          Back to Home
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Load all saved data
      const patientData = JSON.parse(localStorage.getItem('patientData'));
      const doctorData = JSON.parse(localStorage.getItem('selectedDoctor'));
      const appointmentData = JSON.parse(localStorage.getItem('appointmentData'));
      
      // Redirect if any data is missing
      if (!patientData || !doctorData || !appointmentData) {
        window.location.href = 'patient-details.html';
        return;
      }
      
      // Fill in confirmation details
      document.getElementById('confirmPatientName').textContent = patientData.name;
      document.getElementById('confirmPatientAgeGender').textContent = 
        `${patientData.age} / ${patientData.gender}`;
      document.getElementById('confirmPatientBlood').textContent = patientData.blood;
      document.getElementById('confirmPatientContact').textContent = patientData.contact;
      document.getElementById('confirmDoctor').textContent = doctorData.name;
      document.getElementById('confirmSpecialty').textContent = doctorData.specialty;
      document.getElementById('confirmDate').textContent = appointmentData.date;
      document.getElementById('confirmTime').textContent = appointmentData.time;
    });

    function confirmBooking() {
      const confirmBtn = document.getElementById('confirmBookingBtn');
      confirmBtn.disabled = true;
      confirmBtn.textContent = 'Confirming...';

      // Get data from localStorage
      const patientData = JSON.parse(localStorage.getItem('patientData'));
      const doctorData = JSON.parse(localStorage.getItem('selectedDoctor'));
      const appointmentData = JSON.parse(localStorage.getItem('appointmentData'));

      // Create the data object to send
      const fullAppointment = {
        patient: patientData.name,
        age: patientData.age,
        gender: patientData.gender,
        blood: patientData.blood,
        contact: patientData.contact,
        doctor: doctorData.name,
        specialty: doctorData.specialty,
        date: appointmentData.date,
        time: appointmentData.time
      };

      // Send data to backend using fetch
      fetch('http://localhost:3022/api/confirmations', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(fullAppointment)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to confirm appointment');
        }
        return response.json();
      })
      .then(data => {
        // Show success modal
        document.getElementById('successModal').classList.remove('hidden');

        // Reset button
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm Booking';

        // Optional: Clear localStorage after success
        localStorage.removeItem('patientData');
        localStorage.removeItem('selectedDoctor');
        localStorage.removeItem('appointmentData');
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error confirming appointment');
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm Booking';
      });
    }

    function goToHome() {
      // Clear all stored data
      localStorage.removeItem('patientData');
      localStorage.removeItem('selectedDoctor');
      localStorage.removeItem('appointmentData');
      
      // Redirect to home/patient details page
      window.location.href = 'patient-details.html';
    }
  </script>
</body>
</html>