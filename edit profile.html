<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Profile - MediCare</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-4xl mx-auto py-10 px-4">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Edit Profile</h1>
      <a href="my profile.html" class="text-sm text-blue-600 hover:underline">Back to Dashboard</a>
    </div>

    <form id="profileForm" onsubmit="handleSubmit(event)">
      <!-- Profile Photo -->
      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Profile Photo</h2>
        <p class="text-sm text-gray-500 mb-4">Update your profile picture</p>
        <div class="flex flex-col items-center">
          <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center mb-4 overflow-hidden">
            <img id="preview-image" class="w-full h-full object-cover hidden">
            <span id="placeholder" class="text-gray-400">+</span>
          </div>
          <input type="file" id="photo-upload" accept="image/jpeg,image/jpg,image/png" class="hidden" onchange="handlePhotoChange(event)">
          <label for="photo-upload" class="cursor-pointer bg-gray-100 px-4 py-2 rounded text-sm border border-gray-300 hover:bg-gray-200">
            Upload Photo
          </label>
          <p id="error-message" class="text-xs text-red-500 mt-2 hidden"></p>
          <p class="text-xs text-gray-500 mt-2">Supported formats: JPEG, JPG, PNG. Max size: 5MB</p>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Personal Information</h2>
        <p class="text-sm text-gray-500 mb-4">Update your personal details</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Full Name</label>
            <input type="text" name="fullName" class="w-full border-gray-300 rounded px-3 py-2 border p-3" value="John Doe" required />
          </div>
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Age</label>
            <input type="number" name="age" class="w-full border-gray-300 rounded px-3 py-2 border p-3" value="35" required />
          </div>
          
          <div class="rounded-md md:col-span-2">
            <label class="block text-sm font-medium mb-1">Gender</label>
            <div class="flex space-x-4 mt-1 border p-2">
              <label><input type="radio" name="gender" value="male" class="mr-1" checked> Male</label>
              <label><input type="radio" name="gender" value="female" class="mr-1"> Female</label>
              <label><input type="radio" name="gender" value="other" class="mr-1"> Other</label>
            </div>
          </div>
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Blood Group</label>
            <select name="bloodGroup" class="w-full border-gray-300 rounded px-3 py-2 border p-3" required>
              <option value="">Select</option>
              <option value="O+">O+</option>
              <option value="A+">A+</option>
              <option value="B+">B+</option>
              <option value="AB+">AB+</option>
              <option value="O-">O-</option>
              <option value="A-">A-</option>
              <option value="B-">B-</option>
              <option value="AB-">AB-</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Contact Information -->
      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Contact Information</h2>
        <p class="text-sm text-gray-500 mb-4">Update your contact details</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Email</label>
            <input type="email" name="email" class="w-full border-gray-300 rounded px-3 py-2 border p-3" value="john.doe@example.com" required />
          </div>
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Phone Number</label>
            <input type="tel" name="phone" class="w-full border-gray-300 rounded px-3 py-2 border p-3" value="+1 (555) 123-4567" required />
          </div>
          
          <div class="rounded-md md:col-span-2">
            <label class="block text-sm font-medium mb-1">Address</label>
            <textarea name="address" class="w-full border-gray-300 rounded px-3 py-2 border p-3" rows="2" required>123 Main Street, Apt 4B, New York, NY 10001</textarea>
          </div>
          
          <div class="rounded-md md:col-span-2">
            <label class="block text-sm font-medium mb-1">Emergency Contact</label>
            <input type="text" name="emergencyContact" class="w-full border-gray-300 rounded px-3 py-2 border p-3" value="Jane Doe - +1 (555) 987-6543 (Spouse)" required />
          </div>
        </div>
      </div>

      <!-- Medical Information -->
      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <h2 class="text-xl font-semibold mb-2">Medical Information</h2>
        <p class="text-sm text-gray-500 mb-4">Update your medical history</p>
        <div class="space-y-4">
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Medical History</label>
            <textarea name="medicalHistory" class="w-full border-gray-300 rounded px-3 py-2 border p-3" rows="2"></textarea>
          </div>
          
          <div class="rounded-md">
            <label class="block text-sm font-medium mb-1">Current Medications</label>
            <textarea name="currentMedications" class="w-full border-gray-300 rounded px-3 py-2 border p-3" rows="2"></textarea>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-end space-x-4">
        <button type="button" onclick="resetForm()" class="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-100">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-black text-white rounded text-sm hover:bg-gray-800">Save Changes</button>
      </div>
    </form>
  </div>

  <script>
    // Photo upload handling
    function handlePhotoChange(event) {
      const file = event.target.files[0];
      const errorMessage = document.getElementById('error-message');
      const previewImage = document.getElementById('preview-image');
      const placeholder = document.getElementById('placeholder');
      
      // Reset error message
      errorMessage.classList.add('hidden');
      
      if (file) {
        // Validate file type
        const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
        if (!validTypes.includes(file.type)) {
          errorMessage.textContent = 'Please upload only JPEG, JPG, or PNG files.';
          errorMessage.classList.remove('hidden');
          event.target.value = ''; // Reset file input
          return;
        }
        
        // Validate file size (5MB = 5 * 1024 * 1024 bytes)
        if (file.size > 5 * 1024 * 1024) {
          errorMessage.textContent = 'File size must be less than 5MB.';
          errorMessage.classList.remove('hidden');
          event.target.value = ''; // Reset file input
          return;
        }
        
        // Preview the image
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImage.src = e.target.result;
          previewImage.classList.remove('hidden');
          placeholder.classList.add('hidden');
          // Store the image data immediately
          localStorage.setItem('profilePhoto', e.target.result);
        };
        reader.readAsDataURL(file);
      }
    }

    // Save changes functionality
    async function handleSubmit(event) {
      event.preventDefault();
      
      // Show loading state
      const submitButton = event.target.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.textContent = 'Saving...';
      submitButton.disabled = true;

      try {
        const formData = new FormData(event.target);
        
        // Create an object with all form data
        const formObject = {};
        formData.forEach((value, key) => {
          formObject[key] = value;
        });

        // Save to localStorage
        localStorage.setItem('profileData', JSON.stringify(formObject));

        // Show success message
        alert('Profile updated successfully!');
        
        // Redirect to my profile page
        window.location.href = 'my profile.html';
        
      } catch (error) {
        console.error('Error saving profile:', error);
        alert('Failed to save changes. Please try again.');
      } finally {
        // Reset button state
        submitButton.textContent = originalText;
        submitButton.disabled = false;
      }
    }

    // Reset form functionality
    function resetForm() {
      if (confirm('Are you sure you want to reset all changes?')) {
        document.getElementById('profileForm').reset();
        // Reset the profile photo preview
        document.getElementById('preview-image').classList.add('hidden');
        document.getElementById('placeholder').classList.remove('hidden');
      }
    }

    // Initialize form with existing data if available
    function initializeForm() {
      const savedData = localStorage.getItem('profileData');
      if (savedData) {
        const data = JSON.parse(savedData);
        
        // Fill form fields with saved data
        Object.keys(data).forEach(key => {
          const element = document.querySelector(`[name="${key}"]`);
          if (element) {
            if (element.type === 'radio') {
              document.querySelector(`[name="${key}"][value="${data[key]}"]`).checked = true;
            } else {
              element.value = data[key];
            }
          }
        });
      }

      // Load saved photo if exists
      const savedPhoto = localStorage.getItem('profilePhoto');
      if (savedPhoto) {
        const previewImage = document.getElementById('preview-image');
        const placeholder = document.getElementById('placeholder');
        previewImage.src = savedPhoto;
        previewImage.classList.remove('hidden');
        placeholder.classList.add('hidden');
      }
    }

    // Call initialize function when page loads
    document.addEventListener('DOMContentLoaded', initializeForm);
  </script>
</body>
</html>